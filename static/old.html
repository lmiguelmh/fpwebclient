<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>FingerprintWebClient Demo Page</title>
    <script src="js/FPApplication.min.js" type="text/javascript"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="css/bulma-0.7.5.min.css">
    <script defer src="js/fontawesome-5.3.1.all.min.js"></script>
</head>
<body>
<section class="hero is-light">
    <div class="hero-body">
        <div class="container">
            <h1 class="title">
                FingerprintWebClient Demo Page
            </h1>
            <h2 class="subtitle">
                This demo will launch the daemon on port 42000.
            </h2>
        </div>
    </div>
</section>

<section class="section">
    <div class="content">
        <h3>
            Instructions
        </h3>

        <ol>
            <li>Uninstall previous version (if present)</li>
            <li>Download installer: <a href="data/core42fp-1.1.exe" target="_blank">core42fp-1.0.0</a></li>
            <li>Execute installer as admin</li>
        </ol>
        <!--<p>
            <button class="button" onclick="doClick()">Launch application</button>
        </p>-->
        <div class="column is-6">
            <div class="field">
                <label class="label" for="message">message</label>
                <div class="control">
                    <input id="message" class="input" type="text" placeholder="Text input">
                </div>
            </div>

            <div class="field">
                <div class="control">
                    <label class="checkbox">
                        <input id="use-dummy" type="checkbox" onchange="doChangeMessage(this)">
                        use dummy child
                    </label>
                </div>
            </div>

            <div class="field is-grouped">
                <div class="control">
                    <button class="button" onclick="doClick()">Launch application</button>
                </div>
            </div>
        </div>

        <article class="message" id="output" style="display: none">
            <div class="message-header">
                <p id="message-header">Sample output</p>
                <!-- <button class="delete" aria-label="delete"></button> -->
            </div>
            <div class="message-body" id="messsage-body">
                <!--
                Lorem ipsum dolor sit amet, consectetur adipiscing elit. <strong>Pellentesque risus mi</strong>, tempus quis placerat ut, porta nec nulla. Vestibulum rhoncus ac ex sit amet fringilla. Nullam gravida purus diam, et dictum <a>felis
                venenatis</a> efficitur. Aenean ac <em>eleifend lacus</em>, in mollis lectus. Donec sodales, arcu et sollicitudin porttitor, tortor urna tempor ligula, id porttitor mi magna a neque. Donec dui urna, vehicula et sem eget,
                facilisis sodales sem.
                <ul>
                    <li>Mensaje recibido</li>
                </ul>
                -->
            </div>
        </article>
    </div>
</section>

<script>
    function doChangeMessage(checkbox) {
        let message = document.querySelector("#message");
        if (checkbox.checked) {
            message.value = '{"command": ".\\\\dummy.exe", "message": "wsq.wsq"}';
        } else {
            message.value = '{"command": ".\\\\futronic\\\\x64\\\\futronic.exe", "message": "PULSE SU MEÃ‘IQUE IZQUIERDO"}';
        }
    }

    function printObjectOnDiv(object, imgfields) {
        var div = document.createElement("div");
        div.style.display = "block";
        for (var property in object) {
            if (object.hasOwnProperty(property)) {
                var span = document.createElement("span");
                span.style.margin = "4pt";
                if (imgfields && imgfields.indexOf(property) !== -1) {
                    var img = new Image;
                    img.src = "data:image/jpeg;base64," + object[property];
                    span.innerText = property + ": ";
                    span.appendChild(img);
                    span.style.display = "block";
                    div.appendChild(span);
                } else {
                    span.innerText = property + ": " + object[property];
                    span.style.display = "block";
                    div.appendChild(span);
                }
            }
        }
        return div;
    }

    function doClick() {
        let child = document.querySelector("#use-dummy").checked ? "dummy" : "core42-device";
        let port = document.querySelector("#use-dummy").checked ? 42424 : 42000;
        let message = document.querySelector("#message");
        FPApplication.execute(JSON.parse(message.value), child, port)
            .then((response) => {
                console.log(response);

                let container = document.querySelector("#output");
                container.style.display = "block";
                //container.classList.add();
                let header = document.querySelector("#message-header");
                header.innerHTML = "Salida";
                let body = document.querySelector("#messsage-body");
                // body.innerHTML = response;

                try {
                    let o = JSON.parse(response);
                    body.appendChild(printObjectOnDiv(o, ["wsq"]));
                } catch (e) {
                    // todo child must send messages in a json object!
                    body.innerHTML = response;
                }

            }).catch((error) => {
                console.log(error);

                let container = document.querySelector("#output");
                container.style.display = "block";
                //container.classList.add();
                let header = document.querySelector("#message-header");
                header.innerHTML = "Error";
                let body = document.querySelector("#messsage-body");
                body.innerHTML = error;
            }
        );
    }

    window.onload = function () {
        doChangeMessage(document.querySelector("#use-dummy"));
    };
</script>
</body>
</html>