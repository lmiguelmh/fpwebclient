"use strict";require("core-js/modules/es6.promise");require("core-js/modules/es6.object.to-string");function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}function _createClass(Constructor,protoProps,staticProps){if(protoProps)_defineProperties(Constructor.prototype,protoProps);if(staticProps)_defineProperties(Constructor,staticProps);return Constructor}var vars=require("./vars");var messages=require("./messages");var URIUtils=require("./URIUtils");var NativeApplication=require("./NativeApplication");var PORT=42001;var TIMEOUT=5000;var CHILD="read.config.exe";var ReadConfigNativeApp=function(){function ReadConfigNativeApp(){_classCallCheck(this,ReadConfigNativeApp)}_createClass(ReadConfigNativeApp,null,[{key:"readJSON",value:function readJSON(config){return new Promise(function(resolve,reject){try{var launcherArgs={port:PORT,timeout:TIMEOUT,child:CHILD};var buffer="";var errorEvent=false;var nativeApplication=new NativeApplication(function(){nativeApplication.send(config)},function(message){buffer+=message+"\n"},function(){if(!errorEvent){try{resolve(JSON.parse(buffer))}catch(e){reject(e)}}},function(error){errorEvent=true;reject(error)},function(){var uri=URIUtils.buildUri(vars.URI_PROTOCOL,"fp",launcherArgs);URIUtils.launch(uri)},250);nativeApplication.connect(launcherArgs,new Date().getTime(),false)}catch(e){reject(e)}})}}]);return ReadConfigNativeApp}();global.ReadConfigNativeApp=ReadConfigNativeApp;module.exports=ReadConfigNativeApp;